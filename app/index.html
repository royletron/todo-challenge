<!DOCTYPE html>
<html>
<head>
	<title>React component</title>
	<link href="./main.css" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous"/>
	<link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
	<script src="https://fb.me/react-0.13.3.min.js"></script>
	<script src="https://fb.me/react-with-addons-0.14.3.min.js"></script>
	<script src="https://fb.me/react-dom-0.14.3.min.js"></script>
	<script src="https://fb.me/JSXTransformer-0.13.3.js"></script>
</head>
<body>
	<div id="react-container">
	</div>
	<script type="text/jsx">

		//not sure if note text should be stored here or in ToDoItem
		var ToDoList = React.createClass ({
			getInitialState: function() {
				//sets the currentID to 0 and sets up the object that holds the items by id
				return ({currentID: 0, notes: {0: {text: "Enter item", tickedState: false, editingState: true} } });
			},

			update: function(newText, i) {
				//when the save button is pressed, this function is triggered
				//sets state for any text changes to a particular item
				var items = this.state.notes;
				items[i].text = newText;
				items[i].tickedState = false;
				items[i].editingState = false;
				this.setState({notes:items});
			},

			changeText: function(i, text) {
				var items = this.state.notes;
				items[i].text = text;
				this.setState({notes: items})
			},

			add: function () {
				//when a new item is adding, this increments the id and add a new item to the object
				//prevent user from adding more than 7 items
				var items = this.state.notes;
				var keys = Object.keys(items);

				if (keys.length < 7) {
					var nextID = this.state.currentID+1;
					this.setState( {currentID: nextID});
					items[nextID] = {};
					items[nextID].text = "Enter item";
					items[nextID].tickedState = false;
					items[nextID].editingState = true;
					this.setState({notes: items});
				} else {
					alert("Finish an item before adding another.")
				};
			},

			handleTick: function(i) {
				//toggles state ticked
				//always sets editing to false
				//this.setState({ticked: !this.state.ticked, editing: false})
				var items = this.state.notes;
				items[i].tickedState = !items[i].tickedState;
				items[i].editingState = false;
				this.setState({notes: items});
			},

			edit: function(i, text) {
				//triggers when the edit button is pressed
				var items = this.state.notes;
				items[i].text = text;
				items[i].editingState = true;
				this.setState({notes: items});
			},

			remove: function(i) {
				//remove an item by id
				var items = this.state.notes;
				delete items[i];
				this.setState({notes: items});
			},

			eachItem: function(i) {
				//returns what should be rendered for each item in the object
				//ToDoItem is a component 
				//passes two methods, update and remove, to the children
				return (<li>
							<ToDoItem
								index={i} 
								onSave={this.update}
								onTextChange = {this.changeText}
								onRemove={this.remove}
								onTickChange={this.handleTick}
								onEditClick={this.edit}
								tickedState={this.state.notes[i].tickedState}
								editingState={this.state.notes[i].editingState}
								text={this.state.notes[i].text}>
							</ToDoItem></li>);
			},

			render: function() {
				//renders all of the items in the list
				var items = [];
				var keys = Object.keys(this.state.notes);
				for (var i=0; i < keys.length; i++) {
					items.push(this.eachItem(keys[i]));
				}

				return (
					<div className="list-bg">
						<div id="listDiv" ref="list">
							<h1 className="listTitle">To do list</h1>
							<ul className="toDoItemList">
								{items}
							</ul>
						</div>
						<div id="addButtonDiv">
							<button type="button" onClick={this.add} className="addButton btn btn-primary glyphicon glyphicon-plus"/>
						</div>
					</div>
					);
			}
		})

		var ToDoItem = React.createClass ({

			tick: function() {
				this.props.onTickChange(this.props.index);
			},

			edit: function () {
				//changes editing to true
				this.refs.inputText.getDOMNode().value = this.props.text;
				this.props.onEditClick(this.props.index, this.refs.itemText.getDOMNode().innerHTML);
			},

			save: function() {
				//changes editing to false
				//the onSave method is inherited from parent ToDoList
				this.props.onSave(this.refs.inputText.getDOMNode().value, this.props.index);
			},

			textChange: function(event) {
				this.props.onTextChange(this.props.index, event.target.value);
			},

			remove: function() {
				//the onRemove method is inherited from parent ToDoList
				this.props.onRemove(this.props.index);
			},

			render: function() {


				//button display logic
				//essentially, there is only one button showing at a time for any combintation of states
				var displayDelete;
				if (this.props.tickedState) {
					displayDelete = "" }
				else {
					displayDelete = "none"
				};

				var displayEdit;
				if (!this.props.tickedState && !this.props.editingState) {
					displayEdit = "" }
				else {
					displayEdit = "none"
				};

				var displaySave;
				if (!this.props.tickedState && this.props.editingState) {
					displaySave = "" }
				else {
					displaySave = "none"
				};

				var displayInput;
				var displayText;
				if (this.props.editingState) {
					displayInput = "";
					displayText = "none";}
				else {
					displayInput = "none";
					displayText = "";
				};

				//item return consists of tickbox, input text and buttons for save, edit, delete
				return (
					<div>
						<form role="form">
							<div>
								<input onClick={this.tick} className="checkbox itemtickbox" type="checkbox" checked={this.props.tickedState}/>
							</div>
							<div className="textDiv">
								<input onChange={this.textChange} value={this.props.text} type="input" ref="inputText" className="todo-input" style={{display: displayInput}}/>
								<p className="todo-text" ref="itemText" style={{display: displayText}}>{this.props.text}</p>
							</div>
							<div id="functionButtonDiv">
								<div>
									<button type="button" onClick={this.save} className="btn btn-success glyphicon glyphicon-floppy-disk" style={{display: displaySave}}/>
								</div>
								<div>
									<button type="button" onClick={this.edit} className="btn btn-primary glyphicon glyphicon-pencil" style={{display: displayEdit}}/>
								</div>
								<div>
									<button type="button" onClick={this.remove} className="btn btn-danger glyphicon glyphicon-trash" style={{display: displayDelete}}/>
								</div>
							</div>
						</form>
					</div>
				);
			}

		})

		//calling render function
		ReactDOM.render(<ToDoList/>,
			document.getElementById('react-container'));

	</script>
</body>
</html>
